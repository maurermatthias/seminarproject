package test2;

import java.util.List;

import entities.DBentity;
import entities.DBuser;
import entities.Usergroup;
import entities.DBclass;

public class XMLCreator {
	
	public int userId;
	public Usergroup usergroup;
	public int creatorId;

	public XMLCreator(String username, String password){
		List<DBentity> user = DBConnector.select("users", "name='"+username+"' AND password='"+password+"'");
		
		if(user.isEmpty()){
			usergroup = Usergroup.fromInteger(((DBuser)user.get(0)).usergroup);
			userId = 0;
			creatorId = 0;
		}
		else{
			usergroup = Usergroup.fromInteger(((DBuser)user.get(0)).usergroup);
			userId = ((DBuser)user.get(0)).userid;
			if(usergroup == Usergroup.STUDENT)
				creatorId = ((DBuser)user.get(0)).creator;
		}
	}
	
	public String getLoginXML(){
		switch(usergroup){
		case UNKNOWN:
			return getLoginXMLUnknown();
		case STUDENT:
			return getLoginXMLStudent();
		case TEACHER:
			return getLoginXMLTeacher();
		case ADMINISTRATOR:
			return getLoginXMLAdministrator();
		default:
			System.out.println("This line should never be reached!");
			return null;
		}
	}
	
	private String getLoginXMLUnknown(){
		String xml = "<loginxml>";
		xml+= "<usergroup>0</usergroup>";
		return xml+"</loginxml>";
	}
	
	private String getLoginXMLStudent(){
		String xml = "<loginxml>";
		
		xml+= "<usergroup>1</usergroup>";
		
		xml += "<registeredclasses>";
		List<DBentity> entities = DBConnector.getRegisteredClasses(this.userId);
		for(DBentity entity : entities){
			DBclass clazz = (DBclass) entity;
			xml += clazz.toXML();
		}
		xml += "</registeredclasses>";
		
		xml += "<availableclasses>";
		entities = DBConnector.getAvailableClasses(this.creatorId);
		for(DBentity entity : entities){
			DBclass clazz = (DBclass) entity;
			xml += clazz.toXML();
		}
		xml += "</availableclasses>";
		
		
		return xml+"</loginxml>";
	}
	
	private String getLoginXMLTeacher(){
		String xml = "<loginxml>";
		xml+= "<usergroup>2</usergroup>";
		return xml+"</loginxml>";
	}
	
	private String getLoginXMLAdministrator(){
		String xml = "<loginxml>";
		xml+= "<usergroup>3</usergroup>";
		return xml+"</loginxml>";
	}
	
}
